<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>深海拾贝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="深海拾贝">
<meta property="og:url" content="http://blog.lifejs.com/page/3/">
<meta property="og:site_name" content="深海拾贝">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深海拾贝">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="深海拾贝" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="https://avatars2.githubusercontent.com/u/760383?v=3&amp;s=460">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">everdom</a></h1>
		</hgroup>

		
		<p class="header-subtitle">智慧与思想碰撞，科学与艺术汇合。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/everdom/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/everdom" title="weibo">weibo</a>
					        
								<a class="google" target="_blank" href="https://plus.google.com/u/0/102093507923007900383/posts/p/pub" title="google">google</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud">
						<a href="/tags/DSP/" style="font-size: 10.00px;">DSP</a><a href="/tags/c-c/" style="font-size: 10.00px;">c/c++</a><a href="/tags/chrome/" style="font-size: 13.33px;">chrome</a><a href="/tags/cubieboard/" style="font-size: 16.67px;">cubieboard</a><a href="/tags/goagent/" style="font-size: 10.00px;">goagent</a><a href="/tags/gtk/" style="font-size: 13.33px;">gtk</a><a href="/tags/indicator/" style="font-size: 10.00px;">indicator</a><a href="/tags/linux/" style="font-size: 13.33px;">linux</a><a href="/tags/node/" style="font-size: 10.00px;">node</a><a href="/tags/putty/" style="font-size: 10.00px;">putty</a><a href="/tags/ruby/" style="font-size: 10.00px;">ruby</a><a href="/tags/webkit/" style="font-size: 10.00px;">webkit</a><a href="/tags/乱码/" style="font-size: 10.00px;">乱码</a><a href="/tags/多系统/" style="font-size: 10.00px;">多系统</a><a href="/tags/编码/" style="font-size: 10.00px;">编码</a><a href="/tags/设计模式/" style="font-size: 20.00px;">设计模式</a><a href="/tags/软件设计/" style="font-size: 10.00px;">软件设计</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					技术爱好者或是一个极客，致力于web开发，曾做过嵌入式开发，喜欢鼓捣移动开发和设计，崇尚简洁高效，完美主义。
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://avatars2.githubusercontent.com/u/760383?v=3&amp;s=460">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">everdom</a></h1>
			</hgroup>
			
			<p class="header-subtitle">智慧与思想碰撞，科学与艺术汇合。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/everdom/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/everdom" title="weibo">weibo</a>
			        
						<a class="google" target="_blank" href="https://plus.google.com/u/0/102093507923007900383/posts/p/pub" title="google">google</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      
  
    <article id="post-design-mode-facade" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/07/16/design-mode-facade/" class="article-date">
  	<time datetime="2013-07-16T04:43:00.000Z" itemprop="datePublished">Jul 16 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/16/design-mode-facade/">设计模式学习之Facade模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天讲外观模式，这个模式其实理解起来超级简单，为什么呢？这个模式其实我觉得可以用四个字来形容它：化繁为简。因为这个模式就是用来提供简化接口的。什么是简化接口？其实就是将很多复杂的接口组合起来成为一个新接口。你或许会问，把许多复杂的接口组合起来不是会更复杂吗，怎么会变得简单，这不是自相矛盾吗？哈哈，那你就错了，其实外观模式更像一个东西：宏。又拿宏说事儿了，不是上次命令模式里面提到过“命令宏”的吗，这个模式和宏有什么关系呢？嘿嘿，如果把上次“命令宏”称为“狭义的宏”的话，那么外观模式就是“广义的宏”（似乎越来越难理解了……）。</p>
<p>别急，让我慢慢道来，先解决为什么叫“广义的宏”这个问题。首先，广义代表这个模式具有很高的通用性，也就是说，它不只是限于对单一类型的接口进行“捆绑销售”，它还能对不同类型的接口进行“集中甩卖”，哎，说的专业点，就是外观模式可以将不同子系统的接口组合成一个接口供用户使用，而这个接口因为组合了很多的功能，使得用户不用自己去定义n多的子系统，然后自己手动操作这些子系统的方法，而只需要调用这个合成的接口就能完成一大堆的功能，是不是简化了呢？</p>
<p>再来详细讲一下吧，定义还是必须的：</p>
<blockquote>
<p><strong>外观模式：</strong><br>为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>当你要为一个复杂子系统提供一个简单接口时。子系统往往因为不断演化而变得越来越复杂。大多数模式使用时都会产生更多更小的类。这使得子系统更具可重用性，也更容易对子系统进行定制，但这也给那些不需要定制子系统的用户带来一些使用上的困难。Facade 可以提供一个简单的缺省视图，这一视图对大多数用户来说已经足够，而那些需要更多的可定制性的用户可以越过facade层。</li>
<li>客户程序与抽象类的实现部分之间存在着很大的依赖性。引入facade将这个子系统与客户以及其他的子系统分离，可以提高子系统的独立性和可移植性。</li>
<li>当你需要构建一个层次结构的子系统时，使用facade模式定义子系统中每层的入口点。如果子系统之间是相互依赖的，你可以让它们仅通过facade进行通讯，从而简化了它们之间的依赖关系。</li>
</ol>
</blockquote>
<p>再上类图：</p>
<p><a href="http://bcs.duapp.com/everdom-blog/blog/2013_09/facademode.png" target="_blank" rel="external"><img src="http://bcs.duapp.com/everdom-blog/blog/2013_09/facademode.png" alt="facademode"></a></p>
<p>对这类图是不是有点无语？是不是感觉摸不着头脑？呵呵，别被它的外表所吓倒，其实你只需要关心最上面的那个接口就行了，对于subsystem也就是子系统可以完全不需要仔细的考虑，而只需要知道如何调用子系统提供的接口就行了，我们还是用个例子来说吧：</p>
<p>就拿开车来说，开车是需要很多的操作的，很多小细节啊（这可是学驾照时的亲身体会啊），我们简单说一下：开车门-&gt;插钥匙-&gt;启动发动机-&gt;踩离合器-&gt;进档-&gt;松离合器-&gt;松手刹-&gt;加油门-&gt;转动方向盘…（车跑起来了，哈哈，不过后序步骤就要靠你自己了;)）。但随着科技的发展，现在果断出现了全自动的汽车（科技真给力），对于这种全自动的汽车来说，显然没有了人，这些操作就只能又计算机控制了，如果现在要你写一个这样的全自动驾车的程序，使得用户只需要插入钥匙，点击开车按钮就能自动开车了（这就方便了，每个人都会），那该怎么写呢？</p>
<p>是不是觉得很复杂？没关系，让复杂的问题交给科学家吧，咱们要懂得利用他们的成果，嘻嘻，假设科学家们已经将复杂的控制功能封装好了，成为了一个个子系统，比如车门，档位，发动机，离合器，手刹，油门都有了各自的控制方法，那我们现在就只需要写汽车的接口，就三个：权限认证（插钥匙，当然现在科技这么发达，也有可能出现别的验证方式呢），还有开车，停车，怎么做呢：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//汽车的接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> bool <span class="title">auth</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span>();</div><div class="line">}</div><div class="line"></div><div class="line">如前所述，现在科学家提供了很多的控制类接口：</div><div class="line"><span class="comment">//车门接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICarDoor</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span>();</div><div class="line">}</div><div class="line"><span class="comment">//档位接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IGears</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLevel</span>(<span class="keyword">int</span> level);</div><div class="line">}</div><div class="line"><span class="comment">//转向灯接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITurnLight</span></span></div><div class="line">{</div><div class="line">    <span class="comment">//0为左，1为右</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLight</span>(<span class="keyword">int</span> direction);</div><div class="line">}</div><div class="line"><span class="comment">//喇叭接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ISpeaker</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beep</span>();</div><div class="line">}</div><div class="line"><span class="comment">//引擎接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEngine</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refuel</span>();</div><div class="line">}</div><div class="line"><span class="comment">//离合器接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IClutch</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">press</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loose</span>();</div><div class="line">}</div><div class="line"><span class="comment">//手刹接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHandBrake</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pull</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loose</span>();</div><div class="line">}</div><div class="line"><span class="comment">//油门接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccelerator</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span>(<span class="keyword">int</span> level);</div><div class="line">}</div><div class="line"><span class="comment">//方向盘</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IWheel</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLeft</span>(<span class="keyword">int</span> degree);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRight</span>(<span class="keyword">int</span> degree);</div><div class="line">}</div><div class="line"><span class="comment">//权限认证（插钥匙，当然现在科技这么发达，也有可能出现别的验证方式呢），</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAuthSystem</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> bool <span class="title">auth</span>();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>既然已经有了这么多接口，那么我们的自动系统就只需要根据这些接口进行顺序的调用就可以了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoCar</span> <span class="keyword">implements</span> <span class="title">ICar</span></span></div><div class="line">{</div><div class="line">    ICarDoor carDoor;</div><div class="line">    IGears gears;</div><div class="line">    ITurnLight turnLight;</div><div class="line">    ISpeaker speaker;</div><div class="line">    IEngine engine;</div><div class="line">    IClutch clutch;</div><div class="line">    IHandBrake handBrake;</div><div class="line">    IAccelerator accelerator;</div><div class="line">    IWheel wheel;</div><div class="line">    <span class="keyword">public</span> <span class="title">AutoCar</span>(ICarDoor carDoor, IGears gears,  ITurnLight turnLight, ISpeaker speaker, IEngine engine,</div><div class="line">    IClutch clutch, IHandBrake handBrake, IAccelerator accelerator, IWheel wheel, IAuthSystem authSystem)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.carDoor=carDoor;</div><div class="line">        <span class="keyword">this</span>.gears=gears;</div><div class="line">        <span class="keyword">this</span>.turnLight=turnLight;</div><div class="line">        <span class="keyword">this</span>.speaker=speaker;</div><div class="line">        <span class="keyword">this</span>.engine=engine;</div><div class="line">        <span class="keyword">this</span>.clutch=clutch;</div><div class="line">        <span class="keyword">this</span>.handBrake=handBrake;</div><div class="line">        <span class="keyword">this</span>.accelerator=accelerator;</div><div class="line">        <span class="keyword">this</span>.wheel=wheel;</div><div class="line">        <span class="keyword">this</span>.authSystem=authSystem;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span>()</div><div class="line">    {</div><div class="line">        carDoor.close();<span class="comment">//关门都由系统来做，人真懒啊，:)</span></div><div class="line">        <span class="keyword">if</span>(authSystem.auth())<span class="comment">//验证权限</span></div><div class="line">        {</div><div class="line">            engine.open();<span class="comment">//打开发动机</span></div><div class="line">            clutch.press();<span class="comment">//踩死离合器</span></div><div class="line">            gears.setLevel(<span class="number">1</span>);<span class="comment">//进1档</span></div><div class="line">            turnLight.setLight(<span class="number">0</span>);<span class="comment">//开左转向灯</span></div><div class="line">            speaker.beep();<span class="comment">//鸣笛</span></div><div class="line">            clutch.loose();<span class="comment">//松开离合器</span></div><div class="line">            handBrake.loose();<span class="comment">//松手刹</span></div><div class="line">            accelerator.accelerate(<span class="number">1</span>);<span class="comment">//加一点就行了，别过猛了，不然会很暴力的，:)</span></div><div class="line">            <span class="comment">//后面的事交给科学家吧，:)</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span>();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这样一来，用户只需要关心ICar接口就行了，想想当你想出门的时候，只需要打开车门，插入钥匙，然后按“开车”按钮，然后什么都不用管，那将是多么的惬意啊，其实，这一切都得感谢外观模式啊，外观模式就是提供一个非常友好的外观给用户（长得漂亮谁不喜欢啊:)），使得用户不需要关心它内部的实现细节，使用户从繁重的工作中解脱出来。</p>
<p>唉，这上面就是外观模式？不就是把一堆类集合在一起，然后把需要的不同类的方法集中到一个方法里面实现吗，这么简单？是啊，就这么简单！多简单啊！我想现在你应该搞清楚为什么我把外观模式叫做广义的宏了吧，不信你再看看上面的代码，Car类中的drive()方法不就是个典型的宏吗，如果你还不清楚，请深入的学一下office word，:)</p>
<p>好了，这个模式就讲到这里，但顺便提一下另外几个模式：装饰者模式和适配器模式，难道这三个模式有什么共同点吗？是的，它们的共同点就是：对接口进行再次封装。装饰者模式是将被装饰者的接口动态的加上新的职责，适配器模式是将被适配者的接口转换成新的接口，而外观模式则是组合多个系统的接口创造新的接口。各种模式都有各自独特的作用，要看你怎么用了。</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-design-mode-adapter" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/07/10/design-mode-adapter/" class="article-date">
  	<time datetime="2013-07-10T04:38:00.000Z" itemprop="datePublished">Jul 10 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/10/design-mode-adapter/">设计模式学习之Adapter模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天要说适配器模式了，适配器模式其实非常好理解，因为现实中存在很多不同种类的适配器，像usb转串口线就是讲usb接口和串口进行转换，VGA转HDMI线就是讲VGA接口和HDMI接口进行转换，这些都是硬件层次的，那么软件层次的就更好举例了，比如现在有某些usb设备，像usb无线键盘/鼠标啊，usb网卡等等如果直接插到电脑上是不会工作的，必须在电脑端还要装上相应的驱动程序，那么这个驱动程序其实就是一个软件适配器，将usb设备转换成为操作系统能够识别的设备，其实，usb设备远不止这些，到淘宝一查，我来个去，真是什么都有啊：</p>
<p><a href="http://bcs.duapp.com/everdom-blog/blog/2013_09/taobaousb.png" target="_blank" rel="external"><img src="http://bcs.duapp.com/everdom-blog/blog/2013_09/taobaousb.png" alt="taobaousb"></a></p>
<p>其实这些设备不是都有适配器的，有很多只用使用usb进行供电，把usb当电源了，但有些数码设备是确实有适配器的，很简单的就是手机的充电线，现在的智能手机都有一根充电线和一个充电器，充电线的一头是连接手机的，另一头则是一个usb接口，这条线连接到充电器就能给手机充电，连接到电脑就能使电脑和手机之间传输数据。</p>
<p>其实很早以前，就连鼠标键盘这种最常见的设备，都不是用的usb接口，而是用的PS/2接口，但现在支持usb接口的设备是越来越多啊，姑且不论usb到底为什么这么受欢迎（其实就是方便 :) ），我们只看这么多设备是如何做到支持usb接口的，难道说他们都会升级固件？那恐怕不尽然，除非是在usb接口普及之后所生产的新产品，否则那些旧产品要支持新的接口是不现实的，因为是硬件，厂商不可能回收后重做再给用户啊，那多亏啊。那这么说，那些旧产品就不能使用usb接口了啊，那usb接口怎么可能普及的这么快呢？答案是：适配器，不管是硬件的，还是软件的（驱动程序），都能</p>
<p>使采用旧接口的设备使用新的接口。</p>
<p>就比如usb网卡，一个usb网卡其实内部包含了一个usb接口与网卡的转接器，而在电脑端也有相应的网卡驱动让系统识别这是个网卡，它就有硬件和软件两个适配器，当用户需要从网络中请求数据时，操作系统会将请求编码后通过驱动程序从usb接口转发给网卡，网卡中的适配器对收到的请求进行解码后发送给网卡处理，网卡从互联网获得数据后将数据通过网卡适配器进行编码后通过usb接口发给电脑，电脑端操作系统通过驱动程序将数据再次解码后交给用户，这是不是有些复杂？</p>
<p>哎，扯了这么多，还没进入正题呢，既然适配器适用于不同接口之间的转换，那么在设计模式中是如何做到的呢？<br> 还是照本宣科，先把定义摆出来：</p>
<blockquote>
<p><strong>适配器模式：</strong><br>将一个类的接口转换成客户希望的另外一个接口。Adapter 模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>你想使用一个已经存在的类，而它的接口不符合你的需求。</li>
<li>你想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作。</li>
<li>（仅适用于对象Adapter ）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口。</li>
</ol>
</blockquote>
<p>定义总是概括性太强，不适合理解啊，有点懵了吧，下面来看个例子吧，就拿usb网卡来说，比如要做一个usb网卡驱动，操作系统提供的网卡API为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">INetCard</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> Host <span class="title">connect</span>(IPAddr ip);</div><div class="line">    <span class="keyword">public</span> NetData <span class="title">getData</span>(Host host);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendData</span>(Host host, NetData data);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>而usb接口提供的API为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUsb</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> UsbData <span class="title">getData</span>();</div><div class="line">    <span class="keyword">public</span> <span class="title">sendData</span>(UsbData data);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>网卡端的解码的方式为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCardDecoder</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">private</span> UsbData data;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NetCardDecoder</span>(data)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.data=data;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWork</span>(Operator operator)</div><div class="line">    {</div><div class="line">        operator.execute();</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> Operator <span class="title">decode</span>(UsbData data)</div><div class="line">    {</div><div class="line">        <span class="comment">//对USB接口获取的数据进行解析后对不同的请求返回不同的操作对象</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>现在我们要做网卡驱动，所以需要将网卡接口适配成Usb接口，所以我们创造一个网卡适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//网卡数据格式与Usb数据格式的转换工具类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataConvertorTool</span></span></div><div class="line">{</div><div class="line">    <span class="comment">//将UsbData转换NetData</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NetData <span class="title">usbData2Net</span>(UsbData data)</div><div class="line">    {</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="comment">//将NetData转换UsbData</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UsbData <span class="title">netData2Usb</span>(NetData data)</div><div class="line">    {</div><div class="line"></div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//网卡适配器类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCardAdapter</span> <span class="keyword">implements</span> <span class="title">INetCard</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">private</span> IUsb usb;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCardAdapter</span>(<span class="title">IUsb</span> <span class="title">usb</span>)//将被适配者传给适配器</span></div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.usb=usb;</div><div class="line">    }</div><div class="line">    <span class="comment">//适配网卡接口</span></div><div class="line">    <span class="keyword">public</span> Host <span class="title">connect</span>(IPAddr ip)</div><div class="line">    {</div><div class="line">        UsbData data=<span class="keyword">new</span> UsbData(<span class="string">"connect"</span>);</div><div class="line">        data.addParam(<span class="string">"ip"</span>, ip);</div><div class="line">        usb.sendData(data);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> NetData <span class="title">getData</span>(Host host)</div><div class="line">    {</div><div class="line">        UsbData dataRequest=<span class="keyword">new</span> UsbData(<span class="string">"get"</span>);</div><div class="line">        data.addParam(<span class="string">"host"</span>, host);</div><div class="line">        usb.sendData(data);</div><div class="line">        UsbData dataUsbReceive=usb.getData();</div><div class="line">        NetData dataNetReceive=DataConvertorTool.usbData2Net(dataUsbReceive);</div><div class="line">        <span class="keyword">return</span> dataNetReceive;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendData</span>(Host host, NetData data)</div><div class="line">    {</div><div class="line">        UsbData dataRequest=<span class="keyword">new</span> UsbData(<span class="string">"send"</span>);</div><div class="line">        dataRequest.addParam(<span class="string">"host"</span>, host);</div><div class="line">        dataRequest.addParam(<span class="string">"data"</span>,data);</div><div class="line">        usb.sendData(data);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>从上述代码可以看出，适配器通过实现用户接口，并通过组合被适配者接口来实现接口之间的转换，但上述代码中我们只是实现了适配器的一种方式，即用组合的方式实现适配，其实，适配器模式还能使用另外一种方式，即类的多继承，但java中无法实现多继承，所以无法实现，但java支持多接口的继承，所以我个人认为其实概念上也是可以实现的，如果使用第二种方式，可以这样来写适配器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//网卡适配器类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCardAdapter</span> <span class="keyword">implements</span> <span class="title">INetCard</span>, <span class="title">IUsb</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">private</span> IUsb usb;</div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetCardAdapter</span>(<span class="title">IUsb</span> <span class="title">usb</span>)//将被适配者传给适配器</span></div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.usb=usb;</div><div class="line">    }</div><div class="line">    <span class="comment">//适配网卡接口</span></div><div class="line">    <span class="keyword">public</span> Host <span class="title">connect</span>(IPAddr ip)</div><div class="line">    {</div><div class="line">        UsbData data=<span class="keyword">new</span> UsbData(<span class="string">"connect"</span>);</div><div class="line">        data.addParam(<span class="string">"ip"</span>, ip);</div><div class="line">        usb.sendData(data);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> NetData <span class="title">getData</span>(Host host)</div><div class="line">    {</div><div class="line">        UsbData dataRequest=<span class="keyword">new</span> UsbData(<span class="string">"get"</span>);</div><div class="line">        data.addParam(<span class="string">"host"</span>, host);</div><div class="line">        usb.sendData(data);</div><div class="line">        UsbData dataUsbReceive=usb.getData();</div><div class="line">        NetData dataNetReceive=DataConvertorTool.usbData2Net(dataUsbReceive);</div><div class="line">        <span class="keyword">return</span> dataNetReceive;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendData</span>(Host host, NetData data)</div><div class="line">    {</div><div class="line">        UsbData dataRequest=<span class="keyword">new</span> UsbData(<span class="string">"send"</span>);</div><div class="line">        dataRequest.addParam(<span class="string">"host"</span>, host);</div><div class="line">        dataRequest.addParam(<span class="string">"data"</span>,data);</div><div class="line">        usb.sendData(data);</div><div class="line">    }</div><div class="line">    <span class="comment">//继承了Usb接口</span></div><div class="line">    <span class="keyword">public</span> UsbData <span class="title">getData</span>()</div><div class="line">    {</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="title">sendData</span>(UsbData data)</div><div class="line">    {</div><div class="line"></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>但由于只能继承接口，所以对于Usb接口方法还必须重新实现，显然是不现实的，因为这样就不能实现代码的复用和封闭了，自然是没有意义的，但若在c++或其他支持多继承的语言中，通过多继承被适配器类而不是接口可以方便的实现代码复用。</p>
<p>适配器模式与装饰者模式有些类似，它们都是结构型设计模式，然后都是对某个接口进行操作，但它们却有本质的不同：</p>
<p>首先， <strong>适配器模式是将一个接口转换为另一个接口，而装饰者模式并不改变接口，只是在原实现上面动态的添加某种职责</strong> 。<br>其次， <strong>它们的引用对象不一样，适配器模式引用被适配者（属于另一个接口），而装饰者模式引用自身（同一个接口）</strong> 。<br>最后， <strong>它们的使用方式不一样，装饰者模式通过product=new ProductDecorator(product)来包装自身，而适配器模式通过product=new ProductAdapter(otherProduct)来像product一样使用otherProduct</strong> 。</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-design-mode-factory" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/07/02/design-mode-factory/" class="article-date">
  	<time datetime="2013-07-02T04:31:00.000Z" itemprop="datePublished">Jul 2 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a><a class="article-category-link" href="/categories/学习笔记/探索与发现/">探索与发现</a>
  </div>

      
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/07/02/design-mode-factory/">设计模式学习之Factory Method模式和Abstract Factory模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>终于到了工厂模式了，说起工厂模式，不得不把工厂方法模式和抽象工厂模式结合起来说，这两种模式都有工厂，乍听起来还真容易混淆，但它们却是不相同的两种模式，但又互相有联系。那么这两者之间各有什么用途，互相之间又有什么联系呢？一个一个来吧。</p>
<p>既然说起了工厂模式，那么首先有一点是需要搞清的，那就是，所有的工厂模式都是为了将对象的创建过程封装起来，要么 <strong>将创建过程隔离出来</strong> ，要么 <strong>将创建过程抽象成接口</strong>。</p>
<p>那么，在说这两种模式之前，先说一下简单工厂，所谓的简单工厂，其实就是一种最简单的将创建过程隔离的设计方法。我们通常在创建一个对象时，都会用到如下语句：<br>Object o=new Object();</p>
<p>即new一个对象，但这种做法是最最基本最最原始的创建对象的方法，在面向对象的设计中，我们必须要遵循一个原则： <strong>要依赖抽象，不要依赖具体类</strong> 。所以，这种做法因为太过具体，所以我们得想办法把它抽象出来，怎么抽象呢，用简单工厂可以这样实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></div><div class="line">  {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">do</span>()</div><div class="line">    {</div><div class="line">      Object o=SimpleFactory.createObject();</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleFactory</span></span></div><div class="line">  {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">createObject</span>()</div><div class="line">    {</div><div class="line">       Object o=<span class="keyword">new</span> Object();</div><div class="line">       <span class="keyword">return</span> o;</div><div class="line">    }</div><div class="line">  }</div></pre></td></tr></table></figure>

<p>咋看起来变化不大，不就是吧new Object改为一个类的静态方法了吗（其实也可以用非静态方法，不过需要先实例化对象），但这样做却可以适应需求的改变，比如说，我现在想要根据不同的类型创建不同的对象，如果直接用new方法，则会在do方法里面写上很多歌new Object()的语句，而且还有很多的判断，每当新增加一种类型，就得改动Client类代码。而如果将创建对象的过程用简单工厂封装起来，则只需要改动简单工厂里面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//直接用new方法</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></div><div class="line">  {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">do</span>(String type)</div><div class="line">    {</div><div class="line">       Object o;</div><div class="line">       <span class="keyword">switch</span>(type)</div><div class="line">       {</div><div class="line">         <span class="keyword">case</span> <span class="string">"type1"</span>:o=<span class="keyword">new</span> Object1();<span class="keyword">break</span>;<span class="comment">//Object1、Object2都是Object的子类</span></div><div class="line">         <span class="keyword">case</span> <span class="string">"type2"</span>:o=<span class="keyword">new</span> Object2();<span class="keyword">break</span>;</div><div class="line">         <span class="comment">//...</span></div><div class="line">       }</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">//采用简单工厂封装创建过程</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></div><div class="line">  {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">do</span>(String type)</div><div class="line">    {</div><div class="line">      Object o=SimpleFactory.createObject(type);</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleFactory</span></span></div><div class="line">  {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">createObject</span>(String type)</div><div class="line">    {</div><div class="line">       Object o;</div><div class="line">       <span class="keyword">switch</span>(type)</div><div class="line">       {</div><div class="line">         <span class="keyword">case</span> <span class="string">"type1"</span>:o=<span class="keyword">new</span> Object1();<span class="keyword">break</span>;<span class="comment">//Object1、Object2都是Object的子类</span></div><div class="line">         <span class="keyword">case</span> <span class="string">"type2"</span>:o=<span class="keyword">new</span> Object2();<span class="keyword">break</span>;</div><div class="line">         <span class="comment">//...</span></div><div class="line">       }</div><div class="line">       <span class="keyword">return</span> o;</div><div class="line">    }</div><div class="line">  }</div></pre></td></tr></table></figure>

<p>但这样做还是会带来不便，因为还是要改动代码，增加新的判断分支，怎样才能更好的封装以增强可维护性和可扩展性呢，工厂方法模式和抽象工厂模式就可以大大增强简单工厂的作用。</p>
<p>那么首先说说工厂方法模式，先说基本概念吧</p>
<blockquote>
<p><strong>工厂方法模式：</strong><br>定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method 使一个类的实例化延迟到其子类。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>当一个类不知道它所必须创建的对象的类的时候。</li>
<li>当一个类希望由它的子类来指定它所创建的对象的时候。</li>
<li>当类将创建对象的职责委托给多个帮助子类中的某一个，并且你希望将哪一个帮助子类是代理者这一信息局部化的时候。</li>
</ol>
</blockquote>
<p>工厂方法模式中，最重要的一点是“让子类决定实例化那一个类”，这一点怎么才能做到呢，而且这样做有什么好处呢？</p>
<p>还是举例子最好了，对于工厂模式，能举的最好的例子当然是与生产产品有关的了，现在，我们假定生产一种手机，那么我们知道，每种手机都需要很多零部件，然后进行组装，打磨，包装等等，对于手机最主要的零件cpu来说，就有不同类型的cpu，比如高通，intel，苹果，德州仪器，或者mtk等等，那么我们在生产手机时，就需要使用某种芯片，就相当于创建这些对象。但不同手机可以使用不同的芯片，如果采用简单工厂来生产这些芯片，就像下面一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">  Cpu cpu;</div><div class="line">  Memory memory;</div><div class="line">  Screen screen;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCpu</span>();</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makePhone</span>(String phoneType)</div><div class="line">  {</div><div class="line">    <span class="keyword">switch</span>(phoneType)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"iphone4s"</span>:cpu=CpuFactory.createCpu(<span class="string">"apple A5"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"三星i9100"</span>:cpu=CpuFatory.createCpu(<span class="string">"高通"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"摩托罗拉me525"</span>:cpu=CpuFactory.createCpu(<span class="string">"高通"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"华为8500"</span>:cpu=CpuFactory.createCpu(<span class="string">"德州仪器"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"诺基亚"</span>:cpu=CpuFactory.createCpu(<span class="string">"intel"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">package</span>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Cpu <span class="title">createCpu</span>(String cpuType)</div><div class="line">  {</div><div class="line">    Cpu cpu;</div><div class="line">    <span class="keyword">switch</span>(cpuType)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"apple A5"</span>:cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"apple A5X"</span>:cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5X"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"高通1代"</span>:cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"1"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"高通2代"</span>:cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"德州仪器"</span>:cpu=<span class="keyword">new</span> TiCpu();<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"intel"</span>:cpu=<span class="keyword">new</span> IntelCpu();<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>那么，如果增加新的cpu，就要在CpuFactory里面再增加新的判断分支。而如果使用工厂方法模式，就可以这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> String type;</div><div class="line">  <span class="keyword">protected</span> Cpu cpu;</div><div class="line">  <span class="keyword">protected</span> Memory memory;</div><div class="line">  <span class="keyword">protected</span> Screen screen;</div><div class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> Cpu <span class="title">getCpu</span>();</div><div class="line">  <span class="keyword">public</span> <span class="title">Cellphone</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.type=type;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makePhone</span>()</div><div class="line">  {</div><div class="line">    cpu=getCpu();</div><div class="line">    <span class="comment">//..</span></div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">package</span>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Iphone</span> <span class="keyword">extends</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">   <span class="keyword">public</span> Cpu <span class="title">getCpu</span>()</div><div class="line">   {</div><div class="line">      <span class="keyword">switch</span>(type)</div><div class="line">      {</div><div class="line">        <span class="keyword">case</span> <span class="string">"3gs"</span>:cpu=CpuFactory.createCpu(<span class="string">"apple A3"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"4"</span>:cpu=CpuFactory.createCpu(<span class="string">"apple A5"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"4s"</span>:cpu=CpuFactory.createCpu(<span class="string">"apple A5X"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"5"</span>:cpu=CpuFactory.createCpu(<span class="string">"apple A6"</span>);</div><div class="line">        <span class="comment">//...</span></div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Motorola</span> <span class="keyword">extends</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> Cpu <span class="title">getCpu</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">switch</span>(type)</div><div class="line">      {</div><div class="line">        <span class="keyword">case</span> <span class="string">"millstone"</span>:cpu=CpuFactory.createCpu(<span class="string">"高通1代"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"me525"</span>:cpu=CpuFactory.createCpu(<span class="string">"高通2代"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"millstone2"</span>:cpu=CpuFactory.createCpu(<span class="string">"高通2代"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"xt860"</span>:cpu=CpuFactory.createCpu(<span class="string">"高通3代"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="comment">//...</span></div><div class="line">      }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//...</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Cpu <span class="title">createCpu</span>(String cpuType)</div><div class="line">  {</div><div class="line">    Cpu cpu;</div><div class="line">    <span class="keyword">switch</span>(cpuType)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"apple A5"</span>:cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"apple A5X"</span>:cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5X"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"高通1代"</span>:cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"1"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"高通2代"</span>:cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"德州仪器"</span>:cpu=<span class="keyword">new</span> TiCpu();<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"intel"</span>:cpu=<span class="keyword">new</span> IntelCpu();<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>对于上例来说，我们将不同类型的手机分离了出来，让它们共同继承Cellphone基类，显得结构清晰，便于扩展，比如现在如果有一款三星的手机，就只需要继承新建一个Samsung类然后继承Cellphone类，然后重写getCpu方法即可实现三星手机的cpu采购过程。也就是说，getCpu作为一个抽象的创建cpu的方法，让子类去具体实现。</p>
<p>像这种结构，就体现了“具体的手机产品需要具体的cpu类型”的设计。也就是“定义一个用于创建对象的接口(getCpu)，让子类决定实例化哪一个类”，在Iphone类和Motorola类中分别实现了getCpu方法，使用简单工厂产生了各种的cpu。在这里，并不是采用工厂方法模式取代简单工厂，而是将简单工厂也应用到了工厂方法模式当中，因为这两者是不同的设计思想，也即 <strong>工厂方法模式是将创建过程抽象成接口</strong> ，而 <strong>简单工厂是将创建过程隔离出来</strong> 。而抽象工厂模式则是这两种思想的进一步结合和升华。</p>
<blockquote>
<p><strong>抽象工厂模式：</strong><br>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>一个系统要独立于它的产品的创建、组合和表示时。</li>
<li>一个系统要由多个产品系列中的一个来配置时。</li>
<li>当你要强调一系列相关的产品对象的设计以便进行联合使用时。</li>
<li>当你提供一个产品类库，而只想显示它们的接口而不是实现时。</li>
</ol>
</blockquote>
<p>前面的例子虽然将不同的手机种类从判断分支中解脱了出来，但对于cpu的制作仍然显得比较乱，也就是说CpuFactory承担了所有的cpu制作任务（搞垄断啊:&gt;），而cpu的型号五花八门，同一种型号的cpu也有很多的版本，如果放到一个工厂生产，实在不是一个聪明的做法，所以，我们自然考虑将不同的cpu从一个简单工厂解脱出来，分别由不同的工厂来生产（这样才有竞争嘛:&gt;），因此，我们将简单工厂改造成抽象工厂，怎么改造？看下面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//抽象工厂类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  Cpu cpu;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> Cpu <span class="title">createCpu</span>(String type);</div><div class="line">}</div><div class="line"><span class="comment">//苹果cpu工厂类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleCpuFactory</span> <span class="keyword">extends</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> Cpu <span class="title">createCpu</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">switch</span>(type)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"A3"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A3"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"A5"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"A5X"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A5X"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"A6"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> AppleCpu(<span class="string">"A6"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//高通cpu工厂类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QualcommCpuFactory</span> <span class="keyword">extends</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> Cpu <span class="title">createCpu</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">switch</span>(type)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"1代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"1"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"2代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"3代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> QualcommCpu(<span class="string">"3"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//德州仪器工厂类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TiCpuFactory</span> <span class="keyword">extends</span> <span class="title">CpuFactory</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> Cpu <span class="title">createCpu</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">switch</span>(type)</div><div class="line">    {</div><div class="line">      <span class="keyword">case</span> <span class="string">"1代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> TiCpu(<span class="string">"1"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"2代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> TiCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="keyword">case</span> <span class="string">"3代"</span>:<span class="keyword">this</span>.cpu=<span class="keyword">new</span> TiCpu(<span class="string">"3"</span>);<span class="keyword">break</span>;</div><div class="line">      <span class="comment">//...</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//cpu产品抽象类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cpu</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> <span class="keyword">float</span> frequency;</div><div class="line">  <span class="keyword">protected</span> String type;</div><div class="line">  <span class="keyword">public</span> <span class="title">Cpu</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.type=type;</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//苹果cpu产品类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleCpu</span> <span class="keyword">extends</span> <span class="title">Cpu</span></span></div><div class="line">{</div><div class="line">}</div><div class="line"><span class="comment">//高通cpu产品类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QualcommCpu</span> <span class="keyword">extends</span> <span class="title">Cpu</span></span></div><div class="line">{</div><div class="line">}</div><div class="line"><span class="comment">//德州仪器cpu产品类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TiCpu</span> <span class="keyword">extends</span> <span class="title">Cpu</span></span></div><div class="line">{</div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用这种模式，就将各种具体的工厂分出了清晰的结构，也就是将工厂也抽象成接口了，这就是为什么叫“抽象工厂”的原因。<br>既然我们升级简单工厂为抽象工厂，那么创造产品自然就要用新的接口方法了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> String type;</div><div class="line">  <span class="keyword">protected</span> Cpu cpu;</div><div class="line">  <span class="keyword">protected</span> Memory memory;</div><div class="line">  <span class="keyword">protected</span> Screen screen;</div><div class="line">  <span class="keyword">protected</span> CpuFactory cpuFactory;</div><div class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> Cpu <span class="title">getCpu</span>();</div><div class="line">  <span class="keyword">public</span> <span class="title">Cellphone</span>(String type)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.type=type;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makePhone</span>()</div><div class="line">  {</div><div class="line">    cpu=getCpu();</div><div class="line">    <span class="comment">//..</span></div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">package</span>(){};</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Iphone</span> <span class="keyword">extends</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">   <span class="keyword">public</span> Cpu <span class="title">getCpu</span>()</div><div class="line">   {</div><div class="line">      <span class="keyword">this</span>.cpuFactory=<span class="keyword">new</span> AppleCpuFactory();<span class="comment">//由于创建产品的方法不再是静态方法，所以需要创建实例</span></div><div class="line">      <span class="keyword">switch</span>(type)</div><div class="line">      {</div><div class="line">        <span class="keyword">case</span> <span class="string">"3gs"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"A3"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"4"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"A5"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"4s"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"A5X"</span>);</div><div class="line">        <span class="keyword">case</span> <span class="string">"5"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"A6"</span>);</div><div class="line">        <span class="comment">//...</span></div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Motorola</span> <span class="keyword">extends</span> <span class="title">Cellphone</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> Cpu <span class="title">getCpu</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.cpuFactory=<span class="keyword">new</span> QualcommCpuFactory();</div><div class="line">    <span class="keyword">switch</span>(type)</div><div class="line">      {</div><div class="line">        <span class="keyword">case</span> <span class="string">"millstone"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"1"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"me525"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"millstone2"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"2"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">"xt860"</span>:cpu=<span class="keyword">this</span>.cpuFactory.createCpu(<span class="string">"3"</span>);<span class="keyword">break</span>;</div><div class="line">        <span class="comment">//...</span></div><div class="line">      }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>这样一来，整个结构就清晰多了，用一句话概括就是：由具体的手机使用具体的工厂生产具体的cpu，但手机、工厂和cpu都通过接口进行交互，较好的封装了各自的实现，从而达到了较好的可扩展性，大大降低了各自的耦合性。现在，如果要添加新的手机、新的cpu，就可以建立新类型的工厂来实现对新的cpu的创建过程。</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-design-mode-command" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/24/design-mode-command/" class="article-date">
  	<time datetime="2013-06-24T02:21:00.000Z" itemprop="datePublished">Jun 24 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/24/design-mode-command/">设计模式之Command模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天学习了命令模式，这个模式非常的给力，它能将命令封装起来让另外的执行者去执行，相当于一个命令的收集和转发过程，而且，这个模式还能将一系列的命令组合成“命令宏”，并且可以轻松的完成撤销的操作，非常适合日志系统或事务处理系统，也常用于窗口编程中的菜单命令处理，好了，下面回顾一下这个模式吧</p>
<blockquote>
<p><strong>命令模式：</strong><br>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤消的操作。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>抽象出待执行的动作以参数化某对象，你可用过程语言中的回调（callback）函数表达这种参数化机制。所谓回调函数是指函数先在某处注册，而它将在稍后某个需要的时候被调用。Command 模式是回调机制的一个面向对象的替代品。</li>
<li>在不同的时刻指定、排列和执行请求。一个Command 对象可以有一个与初始请求无关的生存期。如果一个请求的接收者可用一种与地址空间无关的方式表达，那么就可将负责该请求的命令对象传送给另一个不同的进程并在那儿实现该请求。</li>
<li>支持取消操作。Command 的Excute 操作可在实施操作前将状态存储起来，在取消操作时这个状态用来消除该操作的影响。Command 接口必须添加一个Unexecute 操作，该操作取消上一次Execute 调用的效果。执行的命令被存储在一个历史列表中。可通过向后和向前遍历这一列表并分别调用Unexecute 和Execute 来实现重数不限的“取消”和“重做”。</li>
<li>支持修改日志，这样当系统崩溃时，这些修改可以被重做一遍。在Command 接口中添加装载操作和存储操作，可以用来保持变动的一个一致的修改日志。从崩溃中恢复的过程包括从磁盘中重新读入记录下来的命令并用Execute 操作重新执行它们。</li>
<li>用构建在原语操作上的高层操作构造一个系统。这样一种结构在支持事务( transaction )的信息系统中很常见。一个事务封装了对数据的一组变动。Command 模式提供了对事务进行建模的方法。Command 有一个公共的接口，使得你可以用同一种方式调用所有的事务。同时使用该模式也易于添加新事务以扩展系统。</li>
</ol>
</blockquote>
<p>这个模式怎么举例呢？既然是命令模式，那么就找一些需要发送命令的场合吧，最常见的当然是软件中的菜单了，每一个菜单对应一个命令，当用户点击菜单的时候就会调用与菜单相关联的命令了，那么怎么来使用命令模式构建菜单呢，看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//菜单接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMenu</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> Item <span class="title">getItem</span>(<span class="keyword">int</span> itemIndex);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span>(Item item);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemLength</span>();</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItem</span>(<span class="keyword">int</span> itemIndex, Command command);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isClicked</span>(<span class="keyword">int</span> itemIndex);</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">implements</span> <span class="title">IMenu</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">protected</span> Item[] items;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> itemLength;</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line">    <span class="keyword">public</span> <span class="title">Menu</span>(String title)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.title=title;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> Item <span class="title">getItem</span>(<span class="keyword">int</span> itemIndex) <span class="keyword">throws</span> OverflowException</div><div class="line">    {</div><div class="line">        <span class="keyword">if</span>(itemIndex&lt;<span class="number">0</span> || itemIndex&gt;itemLength-<span class="number">1</span>)</div><div class="line">        {</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OverflowException(<span class="string">"out of range"</span>);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> items[itemIndex];</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span>(Item item)</div><div class="line">    {</div><div class="line">        <span class="keyword">if</span>(item != NullItem)</div><div class="line">        {</div><div class="line">            items.add(item);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItem</span>(<span class="keyword">int</span> itemIndex, ICommand command)</div><div class="line">    {</div><div class="line">        <span class="keyword">if</span>(itemIndex&lt;<span class="number">0</span> || itemIndex&gt;itemLength-<span class="number">1</span>)</div><div class="line">        {</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OverflowException(<span class="string">"out of range"</span>);</div><div class="line">        }</div><div class="line">        Items[itemIndex].setCommand(command);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">isClicked</span>(<span class="keyword">int</span> itemIndex)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.getItem(itemIndex).isClicked();</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//菜单项目</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">private</span> Command command;</div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line">    <span class="keyword">public</span> <span class="title">Item</span>(String title)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.title=title;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span>(ICommand command)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.command=command;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">isClicked</span>()</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.command.execute();</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//命令接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>();</div><div class="line">}</div><div class="line"><span class="comment">//保存命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    Document document;</div><div class="line">    <span class="keyword">public</span> <span class="title">SaveCommand</span>(Document document)//document参数为接受者</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.document=document;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        <span class="keyword">if</span>(document.isModified())</div><div class="line">        {</div><div class="line">            document.save();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//打开命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    Application application;</div><div class="line">    <span class="keyword">public</span> <span class="title">OpenCommand</span>(Application application)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.application=application;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        Document document=application.open();</div><div class="line">        application.addToWorkplace(document);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//退出命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExitCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    Application application;</div><div class="line">    <span class="keyword">public</span> <span class="title">ExitCommand</span>(Application application)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.application=application;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        Document document;</div><div class="line">        <span class="keyword">for</span>(document=Application.currentDocument(); document!=NullDocument; document=Application.nextDocument())</div><div class="line">        {</div><div class="line">            <span class="keyword">if</span>(document.isModified())</div><div class="line">            {</div><div class="line">                document.alertSave(<span class="string">"您还有修改过的文档尚未保存，是否保存？"</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        application.exit();</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//剪切命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CutCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    SelectedBlock selectedBlock;</div><div class="line">    <span class="keyword">public</span> <span class="title">CutCommand</span>(SelectedBlock selectedBlock)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.selectedBlock=selectedBlock;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        System.Clipboard.save(selectedBlock);</div><div class="line">        selectedBlock.delete();</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//粘贴命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PasteCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    Document document;</div><div class="line">    Object pasteObject</div><div class="line">    <span class="keyword">public</span> <span class="title">PasteCommand</span>(Document document, Object pasteObject)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.document=document;</div><div class="line">        <span class="keyword">this</span>.pasteObject=pasteObject;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        document.insertAt(document.currentCursor(), pasteObject);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveAllCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    Application application;</div><div class="line">    <span class="keyword">public</span> <span class="title">SaveAllCommand</span>(Application application)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.application=application;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        Document document;</div><div class="line">        <span class="keyword">for</span>(document=application.currentDocument(); document!=NullDocument; document=application.nextDocument())</div><div class="line">        {</div><div class="line">            <span class="keyword">if</span>(document.isModified())</div><div class="line">            {</div><div class="line">                document.save();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//客户代码</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] argv)</div><div class="line">    {</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    创建编辑器和新建文档</div><div class="line">        */</div><div class="line">        Application application=<span class="keyword">new</span> Application(<span class="string">"文件编辑器"</span>);</div><div class="line">        Document document=application.<span class="keyword">new</span>(<span class="string">"命令模式日志"</span>);</div><div class="line">        application.addToWorkplace(document);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    创建菜单，项目，命令对象</div><div class="line">        */</div><div class="line">        Menu menuFile=<span class="keyword">new</span> Menu(<span class="string">"文件菜单"</span>);</div><div class="line">        Menu menuEdit=<span class="keyword">new</span> Menu(<span class="string">"编辑菜单"</span>);</div><div class="line">        Item itemSave=<span class="keyword">new</span> Item(<span class="string">"保存"</span>);</div><div class="line">        Item itemOpen=<span class="keyword">new</span> Item(<span class="string">"打开"</span>);</div><div class="line">        Item itemExit=<span class="keyword">new</span> Item(<span class="string">"退出"</span>);</div><div class="line">        menuFile.addItem(itemSave);</div><div class="line">        menuFile.addItem(itemOpen);</div><div class="line">        menuFile.addItem(itemExit);</div><div class="line">        Item itemCut=<span class="keyword">new</span> Item(<span class="string">"剪切"</span>);</div><div class="line">        Item itemPaste=<span class="keyword">new</span> Item(<span class="string">"粘贴"</span>);</div><div class="line">        menuEdit.addItem(itemCut);</div><div class="line">        menuEdit.addItem(itemPaste);</div><div class="line">        ICommand commandSave=SaveCommand(document);</div><div class="line">        ICommand commandOpen=OpenCommand(application);</div><div class="line">        ICommand commandExit=ExitCommand(application);</div><div class="line">        ICommand commandCut=CutCommand(document.selectedBlock());</div><div class="line">        ICommand commandPaste=PasteCommand(document, System.clipboard.currentObject);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    赋予每个项目相应的命令</div><div class="line">        */</div><div class="line">        menuFile.setCommand(<span class="number">0</span>, commandSave);</div><div class="line">        menuFile.setCommand(<span class="number">1</span>, commandOpen);</div><div class="line">        menuFile.setCommand(<span class="number">2</span>, commandExit);</div><div class="line">        menuEdit.setCommand(<span class="number">0</span>, commandCut);</div><div class="line">        menuEdit.setCommand(<span class="number">1</span>, commandPaste);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    模拟菜单操作</div><div class="line">        */</div><div class="line">        menuFile.isClicked(<span class="number">0</span>);<span class="comment">//点击保存</span></div><div class="line">        menuFile.isClicked(<span class="number">1</span>);<span class="comment">//点击打开</span></div><div class="line">        <span class="comment">//用鼠标选中一行文字</span></div><div class="line">        menuEdit.isClicked(<span class="number">0</span>);<span class="comment">//点击剪切</span></div><div class="line">        <span class="comment">//将光标移动到任意位置</span></div><div class="line">        menuEdit.isClicked(<span class="number">1</span>);<span class="comment">//点击粘贴</span></div><div class="line">        menuFile.isClicked(<span class="number">2</span>);<span class="comment">//点击退出</span></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>对于以上设计，是如何运用命令模式的呢？解释一下吧，首先，命令模式有一个公共的命令接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//命令接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>该接口只有一个方法：execute()，这个方法提供给调用者最为简洁的使用该命令的方式，用户根本不需要关心他发出的命令的具体实现细节，他只需要构造一个具体的命令对象并把命令的接收者告诉该对象，然后调用该命令的execute方法即可，命令对象自然心领神会的按照客户的要求将命令传达给接收者，接收者收到命令后具体的执行。在上述代码中，客户创建了菜单并往菜单中添加了具体的菜单项，紧接着又创建了各种命令对象并将命令对象和菜单项绑定到一起，即调用setCommand函数。在创建命令对象的时候，会根据不同的命令对象所需的接收者不同给他们传递不同的接收者对象，比如ExitCommand需要Application类型的接收者，而CutCommand需要SelectedBlock类型的接收者，所以分别传给他们对应类型的接收者对象，最后，由用户操作菜单，使得对应的被点击的菜单项的isClicked事件触发，从而触发对应命令的execute()方法来执行响应的命令。这就是整个命令模式的实现过程。</p>
<p>另外，命令模式其实还可以实现更多的功能，在上面的代码中，命令接口只有一个execute()方法，其实，还可以增加一个undo()方法来执行命令的撤销工作，如果实现了该方法，那么就能对对应的操作进行撤销操作了，此处就不详述了。</p>
<p>还有一个很给力的地方就是，命令可以组合！这是命令模式的精华所在，如果用过office的宏功能就会知道，一个宏可以一下子执行很多的命令，其实这种宏功能就是一种命令的组合，在定义的上述的命令模式后，完全可以定义一个宏命令，比如上面的例子中我想定义一个宏命令，操作次序如下：打开文档-&gt;粘贴-&gt;保存-&gt;退出程序（很无聊吧，:) ），就可以这样实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//宏命令</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacroCommand</span> <span class="keyword">implements</span> <span class="title">ICommand</span></span></div><div class="line">{</div><div class="line">    ICommand[] commands;</div><div class="line">    <span class="keyword">public</span> <span class="title">MacroCommand</span>(ICommand[] commands)</div><div class="line">    {</div><div class="line">        <span class="keyword">this</span>.commands=commands;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span>()</div><div class="line">    {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;commands.length, i++)</div><div class="line">        {</div><div class="line">            commands[i].execute();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//客户代码</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] argv)</div><div class="line">    {</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    创建编辑器和新建文档</div><div class="line">        */</div><div class="line">        Application application=<span class="keyword">new</span> Application(<span class="string">"文件编辑器"</span>);</div><div class="line">        Document document=application.<span class="keyword">new</span>(<span class="string">"命令模式日志"</span>);</div><div class="line">        application.addToWorkplace(document);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    创建菜单，项目，命令对象</div><div class="line">        */</div><div class="line">        ...</div><div class="line">        ICommand commandSave=SaveCommand(document);</div><div class="line">        ICommand commandOpen=OpenCommand(application);</div><div class="line">        ICommand commandExit=ExitCommand(application);</div><div class="line">        ICommand commandCut=CutCommand(document.selectedBlock());</div><div class="line">        ICommand commandPaste=PasteCommand(document, System.clipboard.currentObject);</div><div class="line">        <span class="comment">/*</span></div><div class="line">        *    赋予每个项目相应的命令</div><div class="line">        */</div><div class="line">        ...</div><div class="line">        <span class="comment">/*</span></div><div class="line">        /    模拟宏操作</div><div class="line">        */</div><div class="line">        ICommand commands={commandOpen, commandPaste, commandSave, commandExit};</div><div class="line">        ICommand macroCommand=MacroCommand(commands);</div><div class="line">        macroCommand.execute();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>是不是很酷？:)</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-design-mode-decorator" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/18/design-mode-decorator/" class="article-date">
  	<time datetime="2013-06-18T04:28:00.000Z" itemprop="datePublished">Jun 18 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/18/design-mode-decorator/">设计模式学习之Decorator模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>继续学习设计模式，今天是装饰者模式，它属于结构型模式，首先还是它的基本概念：</p>
<blockquote>
<p><strong>装饰者模式：</strong><br>动态地给一个对象添加一些额外的职责。就增加功能来说，Decorator模式相比生成子类更为灵活。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>在不影响其他对象的情况下，以动态、透明的方式给单个对象添加职责。</li>
<li>处理那些可以撤消的职责。</li>
<li>当不能采用生成子类的方法进行扩充时。一种情况是，可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义被隐藏，或类定义不能用于生成子类。</li>
</ol>
</blockquote>
<p><strong>我的理解是：</strong><br>装饰者模式就好比一个个wrapper（包装器），将一个对象一层层的包装，然后返回包装后的对象，就好比你在网上购买了一个电饭锅，那么这个电饭锅就是最原始的对象，而商家可能会在发货时进行一个初步包装，首先将电饭锅用一层泡沫包起来，然后装入一个纸箱，接着交给快递公司，然后快递公司收到这个物品后，还要进行二次包装，即使用快递公司专门的盒子装起来（或者用麻袋装好），然后贴上胶布开始运输，客户收到的这个箱子自后，一层层解开包装，最后拿出电饭锅。那么所有包装这个电饭锅的东西，像泡沫啊，纸箱啊，盒子啊，胶布啊，都可以算作装饰者，装饰者将原来的对象装饰完之后，会生成一个装饰后的对象，使源对象加上各种装饰品。所以，既然装饰者依赖于被装饰的对象，那么，装饰者在实现时就理所当然需要一个被装饰的对象的引用了，然后装饰完之后该引用就会指向装饰后的对象了。</p>
<p><strong>所以，装饰者模式一定要搞明白装饰者的使用方式。</strong></p>
<p>另外，因为装饰者能够替换源对象，所以在实际实现时需要将装饰者和源对象继承同一个父类（这个和实际有所不同，实际中，装饰者和源对象是不同的对象种类，但设计总归设计，不能总是和实际完美的相符，是需要一些灵活的处理的，而且这种设计的其本质是装饰者装饰之后的对象和源对象属于同一个父类，就好比电饭锅和装在盒子里的电饭锅都是电饭锅一样，但盒子并不是电饭锅）</p>
<p>还有一点就是，实际实现的装饰者，是装饰源对象的某个方法，相当于将被装饰的对象的某个方法增添或替换成某种方法而不改变源对象的代码和结构，就相当于动态的改变某种功能。</p>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//被装饰者接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IProduct</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transport</span>();</div><div class="line">}</div><div class="line"><span class="comment">//具体的被装饰者</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> <span class="keyword">implements</span> <span class="title">IProduct</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> String name;</div><div class="line">  <span class="keyword">public</span> <span class="title">Product</span>(String name)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.name=name;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transport</span>()</div><div class="line">  {</div><div class="line">    System.out.println(<span class="string">"原始的产品："</span>+<span class="keyword">this</span>.name);</div><div class="line">    System.out.println(<span class="string">"运输..."</span>);</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//装饰者类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">IProduct</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> IProduct product;</div><div class="line">  <span class="keyword">protected</span> String name;</div><div class="line">  <span class="keyword">public</span> <span class="title">Decorator</span>(IProduct product, String name)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.product=product;</div><div class="line">    <span class="keyword">this</span>.name=name;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transport</span>()</div><div class="line">  {</div><div class="line">    System.out.println(<span class="string">"包装"</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.product != NULL)</div><div class="line">    {</div><div class="line">      <span class="keyword">this</span>.product.transport();</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//具体的装饰者1</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator1</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Decorator1</span>(IProduct product)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.product=product;</div><div class="line">    <span class="keyword">this</span>.name=<span class="string">"泡沫"</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transport</span>()</div><div class="line">  {</div><div class="line">    System.out.println(<span class="string">"用"</span>+<span class="keyword">this</span>.name+<span class="string">"包装"</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.pruduct != NULL)</div><div class="line">    {</div><div class="line">      <span class="keyword">this</span>.product.transport();</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//具体的装饰者2</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator2</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Decorator1</span>(IProduct product)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.product=product;</div><div class="line">    <span class="keyword">this</span>.name=<span class="string">"纸盒"</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transport</span>()</div><div class="line">  {</div><div class="line">    System.out.println(<span class="string">"用"</span>+<span class="keyword">this</span>.name+<span class="string">"包装"</span>);</div><div class="line">    <span class="keyword">if</span>(pruduct != NULL)</div><div class="line">    {</div><div class="line">      <span class="keyword">this</span>.product.method1();</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String argv[])</div><div class="line">  {</div><div class="line">    IProduct product=<span class="keyword">new</span> Product(<span class="string">"电饭锅"</span>);</div><div class="line">    product=<span class="keyword">new</span> Decorator1(product);<span class="comment">//用泡沫包装</span></div><div class="line">    product=<span class="keyword">new</span> Decorator2(product);<span class="comment">//用纸盒包装</span></div><div class="line">    <span class="comment">/*之后product对象就是被纸盒包装又被泡沫包装的对象了*/</span></div><div class="line">    product.transport();<span class="comment">//从外到里依次输出包装物直到原产品，最后进行运输</span></div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
    <article id="post-design-mode-observer" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/16/design-mode-observer/" class="article-date">
  	<time datetime="2013-06-16T01:37:00.000Z" itemprop="datePublished">Jun 16 2013</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>

      
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/16/design-mode-observer/">设计模式学习之Observer模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天继续学习设计模式。学到的两个模式：观察者模式，它属于行为性模式。</p>
<blockquote>
<p><strong>观察者模式：</strong><br>定义对象间的一种一对多的依赖关系,当一个对象的状态发生改变时, 所有依赖于它的对象都得到通知并被自动更新。</p>
<p><strong>适用性：</strong></p>
<ol>
<li>当一个抽象模型有两个方面, 其中一个方面依赖于另一方面。将这二者封装在独立的对象中以使它们可以各自独立地改变和复用。</li>
<li>当对一个对象的改变需要同时改变其它对象, 而不知道具体有多少对象有待改变。</li>
<li>当一个对象必须通知其它对象，而它又不能假定其它对象是谁。换言之, 你不希望这些对象是紧密耦合的。</li>
</ol>
</blockquote>
<p><strong>我的理解是：</strong><br>观察者模式首先定义了一个被观察者，然后让很多的观察者订阅被观察者，而被观察者在自己的状态有了更新时向所有的观察者“推送”自己的状态信息，从而使所有的观察者都得到通知。其实这个模式让人很容易想到当前一种最为潮流的互联网应用：微博。就拿微博为例，每一个人都可以是观察者与被观察者两种身份，当你关注别人的时候，比如你的一个朋友小罗，你就成为了小罗的粉丝，就相当于此时小罗为被观察者，而你自己是观察者身份，你订阅了被观察者，使被观察者在自己状态发生改变时会及时通知你。比如小罗今天去旅游，他将照片发到了微博上，这样你就能及时的看到他的动态了。而且不只是你，他所有的粉丝都能看到他的动态了。而当你的另外一个朋友，比如小杨关注了你，这样你就成为了被观察者，而小杨就是观察者，当你在微博上的个人中心上发状态时，小杨就能实时看到你的状态了，或者会对你的状态进行评论。所以，Observer模式很容易理解。</p>
<p>那么，如何来实现它呢？其实很简单，主要是在被观察者上面做文章，被观察者类需要引入三个方法：AddObserver, DeleteObserver, Notify。<br>前两个方法用来动态的增加和删除观察者，后面一个方法用来通知所有的观察者。<br>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//被观察者接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IObservarable</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span>(Observer obs);</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteObserver</span>(Observer obs);</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notify</span>();</div><div class="line">}</div><div class="line"><span class="comment">//被观察者类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observarable</span> <span class="keyword">implements</span> <span class="title">IObserverable</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> ArrayList arrObservers;<span class="comment">//存放所有的观察者</span></div><div class="line">  <span class="keyword">protected</span> ArrayList arrStates;<span class="comment">//存放自己的状态以便通知所有的观察者</span></div><div class="line">  <span class="keyword">protected</span> String name;</div><div class="line">  <span class="keyword">public</span> <span class="title">Observarable</span>(String name)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.name=name;</div><div class="line">    <span class="keyword">this</span>.arrObservers=<span class="keyword">new</span> ArrayList();</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span>(Observer obs)</div><div class="line">  {</div><div class="line">    arrObservers.add(obs);</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteObserver</span>(Observer obs)</div><div class="line">  {</div><div class="line">    <span class="keyword">int</span> i=<span class="keyword">this</span>.arrObservers.indexof(obs);</div><div class="line">    <span class="keyword">if</span>(i&gt;=<span class="number">0</span>)</div><div class="line">    {</div><div class="line">      <span class="keyword">this</span>.arrObservers.remove(i);</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notify</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.arrStates=<span class="keyword">new</span> ArrayList();</div><div class="line">    <span class="keyword">this</span>.arrStates.add(<span class="keyword">this</span>.name);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">this</span>.arrObservers.size(); i++)</div><div class="line">    {</div><div class="line">      Observer obs=arrObservers.get(i);</div><div class="line">      obs.update(<span class="keyword">this</span>, <span class="keyword">this</span>.arrStates);</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> string <span class="title">getName</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//更加具体的被观察者（拥有自己的状态）</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observerable1</span> <span class="keyword">extends</span> <span class="title">Observable</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">private</span> State1 state1;</div><div class="line">  <span class="keyword">private</span> State2 state2;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notify</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.arrStates.add(<span class="keyword">this</span>.name);</div><div class="line">    <span class="keyword">this</span>.arrStates.add(<span class="keyword">this</span>.state1);</div><div class="line">    <span class="keyword">this</span>.arrStates.add(<span class="keyword">this</span>.state2);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">this</span>.arrObservers.size(); i++)</div><div class="line">    {</div><div class="line">      Observer obs=arrObservers.get(i);</div><div class="line">      obs.update(<span class="keyword">this</span>, arrStates);</div><div class="line">    }</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> State1 <span class="title">getState1</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state1;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> State2 <span class="title">getState2</span>()</div><div class="line">  {</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state2;</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//观察者接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IObserver</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span>(Observerable o, Object arg);</div><div class="line">}</div><div class="line"><span class="comment">//观察者类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> <span class="keyword">implements</span> <span class="title">IObserver</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span> String name;</div><div class="line">  <span class="keyword">public</span> <span class="title">Observer</span>(String name)</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.name=name;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span>(Observerable o, Object arg)</div><div class="line">  {</div><div class="line">    System.out.println(<span class="string">"Observer "</span>+<span class="keyword">this</span>.name+<span class="string">" has been notified!"</span>);</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//更加具体的观察者1（采用拉的方式）</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer1</span> <span class="keyword">extends</span> <span class="title">Observer</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span>(Observerable o, Object arg)</div><div class="line">  {</div><div class="line">    <span class="keyword">super</span>.update();</div><div class="line">    System.out.println(<span class="string">"I love you!"</span>);</div><div class="line">    System.out.println(<span class="string">"I have get the state of "</span>+o.getName());</div><div class="line">    <span class="keyword">if</span>(o <span class="keyword">instanceof</span> Observerable1)</div><div class="line">    {</div><div class="line">      System.out.println(<span class="string">"state1:"</span>+o.getState1()+<span class="string">", state2:"</span>+o.getState2());</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="comment">//更加具体的观察者2（采用推的方式）</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer2</span> <span class="keyword">extends</span> <span class="title">Observer</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span>(Observerable o, Object arg)</div><div class="line">  {</div><div class="line">    <span class="keyword">super</span>.update();</div><div class="line">    System.out.println(<span class="string">"I love you!"</span>);</div><div class="line">    <span class="keyword">if</span>(o <span class="keyword">instanceof</span> Observerable1)</div><div class="line">    {</div><div class="line">      System.out.println(<span class="string">"I have get the state of "</span>+arg[<span class="number">0</span>].toString());</div><div class="line">      System.out.println(<span class="string">"state1:"</span>+(State1)arg[<span class="number">1</span>].toString()+<span class="string">", state2:"</span>+(State2)arg[<span class="number">2</span>].toString());</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">{</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(string []argv)</div><div class="line">  {</div><div class="line">    Observer1 obs1=<span class="keyword">new</span> Observer1(<span class="string">"xiaoluo"</span>);</div><div class="line">    Observer1 obs2=<span class="keyword">new</span> Observer2(<span class="string">"xiaoyang"</span>);</div><div class="line">    Observerable1 obsb1=<span class="keyword">new</span> Observerable1(<span class="string">"xiaoguo"</span>);</div><div class="line">    obsb1.addObserver(obs1);</div><div class="line">    obsb1.addObserver(obs2);</div><div class="line">    obsb1.notify();</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
    </nav>
  

      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2014 everdom
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>